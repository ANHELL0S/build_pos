import{r as l,m as S,j as e,A as se,I as le,K as ne,c as ie,D as re,M as de,N as W,d as oe,C as ce,B as q,i as xe,k as ue,l as me,S as z,e as pe,E as he,O as fe,P as je,Q as ge,R as be,q as ve,U as Ne,v as ke}from"./index-CwctY5k1.js";import{f as Se}from"./search.util-CoWWLx4z.js";import{R as H,S as we,T as ye}from"./ReportModal-D58ign_A.js";import{g as X,a as _e}from"./kardex.api-D_pMdHmZ.js";import{d as T}from"./date.util-DC23xNcO.js";import{A as Ce}from"./AnimatedDropdown-BizZW_Ly.js";import"./jspdf.plugin.autotable-CTNFFBrn.js";const Re=({k_product:n,onClose:f})=>{var U;const[w,g]=l.useState(!1),[x,m]=l.useState(""),[u,j]=l.useState(""),[p,a]=l.useState(""),[o,c]=l.useState(!1),[r,h]=l.useState(""),[b,B]=l.useState(""),[v,y]=l.useState(""),[N,D]=l.useState(""),[k,s]=l.useState(""),[d,$]=l.useState(!1),[V,E]=l.useState([]),[A,P]=l.useState([]),[K,L]=l.useState(!1);l.useEffect(()=>(c(!0),document.addEventListener("keydown",O),()=>{document.body.style.overflow="",document.removeEventListener("keydown",O)}),[]),l.useEffect(()=>{(async()=>{if(n&&n.product_fk){g(!0);try{const i=await X(n.product_fk);E(i),P(i)}catch{E([]),P([])}finally{g(!1)}}})()},[n]),l.useEffect(()=>{const t=V.filter(i=>{const _=i.detail.toLowerCase().includes(p.toLowerCase()),C=v?i.movement_type===v:!0,R=u&&x?new Date(i.createdAt)>=new Date(u)&&new Date(i.createdAt)<=new Date(x):!0,M=b||r?(b?i.quantity_balance>=b:!0)&&(r?i.quantity_balance<=r:!0):!0,F=N||k?(N?i.unit_value>=N:!0)&&(k?i.unit_value<=k:!0):!0;return _&&C&&R&&M&&F});P(t)},[p,V,v,u,x,b,r,N,k]);const O=t=>{t.key==="Escape"&&(c(!1),setTimeout(f,300))};if(!n)return null;const J=()=>{L(!0)},G=()=>{L(!1)},Y=[["Movimiento","Producto","IVU","Total entrada","Valor entrada","Total Salida","Valor Salida","Total Balance","Valor Balance","Proveedor","Fecha"]],Z=V.map(t=>{var i,_,C,R,M,F,Q;return[t==null?void 0:t.movement_type,t==null?void 0:t.product.code_product,((i=t==null?void 0:t.unit_value)==null?void 0:i.toFixed(2))??"",((_=t==null?void 0:t.quantity_entry)==null?void 0:_.toFixed(2))??"",((C=t==null?void 0:t.total_entry)==null?void 0:C.toFixed(2))??"",((R=t==null?void 0:t.quantity_exit)==null?void 0:R.toFixed(2))??"",((M=t==null?void 0:t.total_exit)==null?void 0:M.toFixed(2))??"",((F=t==null?void 0:t.quantity_balance)==null?void 0:F.toFixed(2))??"",((Q=t==null?void 0:t.total_balance)==null?void 0:Q.toFixed(2))??"",t==null?void 0:t.supplier.company_name,T(t.createdAt)]}),I={hidden:{opacity:0,backdropFilter:"blur(0px)"},visible:{opacity:1,backdropFilter:"blur(2px)",transition:{duration:.2}}},ee={hidden:{opacity:0,scale:1,x:"100%",transition:{duration:.2,ease:"easeInOut"}},visible:{opacity:1,scale:1,x:"0%",transition:{duration:.2,ease:"circIn"}}};console.log(n);const te=S.div,ae=S.table;return e.jsxs(se,{children:[o&&e.jsxs(S.div,{exit:"hidden",initial:"hidden",animate:"visible",variants:I,className:"fixed inset-0 z-50 flex items-center justify-end overflow-auto",onClick:()=>{c(!1),setTimeout(f,300)},children:[e.jsx(S.div,{className:"absolute inset-0 bg-neutral-50/50 dark:bg-neutral-900/50",variants:I}),e.jsxs(S.div,{className:"relative flex h-full max-h-full w-full max-w-3xl flex-col gap-y-5 border bg-white p-6 text-neutral-600 shadow-lg dark:border-neutral-700 dark:bg-neutral-900 dark:text-neutral-300",variants:ee,onClick:t=>t.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(le,{Icon:ne,text:"Historial de Kardex"}),e.jsx("div",{onClick:()=>{c(!1),setTimeout(f,300)},className:"cursor-pointer rounded-md p-1.5 text-lg text-neutral-400 transition-colors duration-150 hover:bg-neutral-100 hover:text-neutral-500 dark:hover:bg-neutral-800 dark:hover:text-neutral-300",children:e.jsx(ie,{})})]}),e.jsx("div",{className:"flex flex-row items-center text-sm",children:e.jsx("div",{className:"flex flex-col gap-4 text-sm text-neutral-600 dark:text-neutral-300",children:e.jsxs("div",{className:"flex flex-row gap-3 text-xs",children:[e.jsx("img",{src:n.product.img_url,alt:n.product.name||"Imagen del producto no especificada",className:"h-auto w-40 rounded-lg border border-neutral-200 dark:border-neutral-700"}),e.jsxs("div",{className:"flex flex-col space-y-4",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("strong",{children:n.description})}),e.jsx("div",{className:"flex flex-col gap-1",children:e.jsxs("span",{className:"flex items-center gap-4 text-xs",children:[e.jsx("span",{className:n.product.active?"rounded-sm bg-green-100 px-2 py-0.5 font-medium text-green-600 dark:bg-green-800/60 dark:text-green-300":"rounded-sm bg-red-100 px-2 py-0.5 font-medium text-red-600 dark:bg-red-800/60 dark:text-red-300",children:n.product.active?"Activo":"Inactivo"}),e.jsxs("span",{className:"flex items-center gap-1 text-xs",children:[e.jsx(re,{})," ",T(n.product.createdAt)]})]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(de,{}),e.jsx("strong",{children:"Proveedor:"}),e.jsx("span",{children:(U=n.product.supplier)==null?void 0:U.company_name})]}),e.jsxs("div",{className:"flex justify-between gap-8",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(W,{}),e.jsx("strong",{children:"Código barras:"}),e.jsx("span",{children:n.code_bar?n.code_bar:"No especificado"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(oe,{}),e.jsx("strong",{children:"Código producto:"}),e.jsx("span",{children:n.product.code_product?n.product.code_product:"No especificado"})]})]})]})]})})}),e.jsxs("div",{className:"text-md relative flex flex-col gap-4",children:[e.jsxs("div",{className:"relative flex items-center justify-between",children:[e.jsxs("p",{className:"text-sm font-medium",children:["Total movimientos (",A.length,")"]}),e.jsxs("div",{className:"flex gap-4 text-sm",children:[e.jsxs("div",{className:"relative flex items-center overflow-hidden rounded-lg border dark:border-neutral-700",children:[e.jsx("input",{type:"text",placeholder:"Buscar por detalle...",value:p,onChange:t=>a(t.target.value),className:"w-full bg-white py-1.5 pl-10 pr-3 outline-none dark:bg-neutral-800 dark:text-white"}),e.jsx(ce,{className:"absolute left-3 text-gray-500 dark:text-gray-400"})]}),e.jsx(q,{onClick:J,variant:"outline",icon:xe,children:"Reporte"}),e.jsx(q,{onClick:()=>$(!d),variant:"outline",children:d?e.jsx(ue,{}):e.jsx(me,{})})]})]}),e.jsx(Ce,{isOpen:d,children:e.jsxs("div",{className:"flex flex-col gap-6 p-4 text-xs font-medium",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"flex items-center text-neutral-500 dark:text-neutral-400",children:"Tipo de movimiento"}),e.jsxs("select",{value:v,onChange:t=>y(t.target.value),className:"mt-2 rounded-md border border-neutral-100 bg-neutral-50 p-2 focus:border-neutral-500 focus:ring-neutral-500 dark:border-neutral-700 dark:bg-neutral-800",children:[e.jsx("option",{value:"",children:"Todos"}),e.jsx("option",{value:"Ajuste",children:"Ajuste"}),e.jsx("option",{value:"Entrada",children:"Entrada"}),e.jsx("option",{value:"Salida",children:"Salida"})]})]}),e.jsxs("div",{className:"flex justify-between gap-4",children:[e.jsxs("div",{className:"flex w-full flex-col",children:[e.jsx("label",{className:"flex items-center text-neutral-500 dark:text-neutral-400",children:"Fecha inicio"}),e.jsx("input",{type:"date",value:u,onChange:t=>j(t.target.value),className:"mt-2 rounded-md border border-neutral-100 bg-neutral-50 p-2 focus:border-neutral-500 focus:ring-neutral-500 dark:border-neutral-700 dark:bg-neutral-800"})]}),e.jsxs("div",{className:"flex w-full flex-col",children:[e.jsx("label",{className:"flex items-center text-neutral-500 dark:text-neutral-400",children:"Fecha fin"}),e.jsx("input",{type:"date",value:x,onChange:t=>m(t.target.value),className:"mt-2 rounded-md border border-neutral-100 bg-neutral-50 p-2 focus:border-neutral-500 focus:ring-neutral-500 dark:border-neutral-700 dark:bg-neutral-800"})]})]}),e.jsx(q,{onClick:()=>{m(""),j(""),a(""),B(""),h(""),y(""),D(""),s("")},variant:"primary",size:"md",children:"Restablecer filtros"})]})})]}),w?e.jsx("div",{className:"my-32 flex items-center justify-center p-4",children:e.jsx(z,{text:"Cargando kardex, espera un momento :)"})}):e.jsx("div",{className:"overflow-y-auto pr-4",children:A.length>0?A.map(t=>e.jsxs(te,{className:"mb-4 rounded-lg border border-b border-neutral-300 bg-neutral-50 dark:border-neutral-700 dark:bg-neutral-800",initial:{opacity:0,y:-100},animate:{opacity:1,y:0},transition:{duration:.3},children:[e.jsxs("div",{className:"flex items-center justify-between px-4 pt-4 text-xs text-neutral-500",children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs font-medium text-neutral-400",children:[e.jsx(pe,{}),e.jsx("span",{children:T(t.createdAt)})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("span",{className:`inline-block rounded-sm px-2 py-1 text-xs font-medium ${t.movement_type==="Entrada"?"bg-green-100 text-green-600 dark:bg-green-800/60 dark:text-green-300":t.movement_type==="Salida"?"bg-red-100 text-red-600 dark:bg-red-800/60 dark:text-red-300":"bg-yellow-100 text-yellow-600 dark:bg-yellow-800/60 dark:text-yellow-300"}`,children:t.movement_type})})]}),e.jsx("p",{className:"px-4 py-3 text-sm font-medium",children:t.detail}),e.jsx("div",{className:"flex justify-between text-xs",children:e.jsxs(ae,{className:"min-w-full table-auto text-xs text-neutral-600 dark:text-neutral-300",initial:{opacity:0},animate:{opacity:1},transition:{duration:.3},children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-y border-neutral-100 bg-neutral-100 text-neutral-500/80 dark:border-neutral-600 dark:bg-neutral-700 dark:text-neutral-400",children:[e.jsx("th",{className:"px-4 py-1 text-left",children:"IVU"}),e.jsx("th",{className:"px-4 py-1 text-left",children:"Total entrada"}),e.jsx("th",{className:"px-4 py-1 text-left",children:"Valor entrada"}),e.jsx("th",{className:"px-4 py-1 text-left",children:"Total salida"}),e.jsx("th",{className:"px-4 py-1 text-left",children:"Valor salida"}),e.jsx("th",{className:"px-4 py-1 text-left",children:"Total balance"}),e.jsx("th",{className:"px-4 py-1 text-left",children:"Valor balance"})]})}),e.jsx("tbody",{children:e.jsxs("tr",{className:"text-neutral-500 dark:text-neutral-300",children:[e.jsx("td",{className:"px-4 py-1",children:t!=null&&t.unit_value?t.unit_value.toFixed(2):""}),e.jsx("td",{className:"px-4 py-1",children:(t==null?void 0:t.quantity_entry)!==null?t.quantity_entry:""}),e.jsx("td",{className:"px-4 py-1",children:(t==null?void 0:t.total_entry)!==null?t.total_entry.toFixed(2):""}),e.jsx("td",{className:"px-4 py-1",children:(t==null?void 0:t.quantity_exit)!==null?t.quantity_exit:""}),e.jsx("td",{className:"px-4 py-1",children:(t==null?void 0:t.total_exit)!==null?t.total_exit.toFixed(2):""}),e.jsx("td",{className:"px-4 py-1",children:(t==null?void 0:t.quantity_balance)!==null?t.quantity_balance:""}),e.jsx("td",{className:"px-4 py-1",children:(t==null?void 0:t.total_balance)!==null?t.total_balance.toFixed(2):""})]})})]})})]},t.id)):e.jsx("div",{className:"py-20",children:e.jsx(he,{title:"Sin resultados :(",description:"Lo sentimos, no se encontraron coincidencias. Por favor, busca otra cosa."})})})]})]}),K&&e.jsx(H,{tableHead:Y,tableBody:Z,title:"Reporte kardex",isOpen:K,onClose:G})]})},Me=({id_product:n,onClose:f})=>{const[w,g]=l.useState([]),[x,m]=l.useState(!1);l.useEffect(()=>{n&&((async()=>{try{const o=await X(n);g(o)}catch(o){console.error("Error al obtener datos del kardex:",o)}})(),m(!0))},[n]);const u=()=>{m(!1),f()},j=[["Movimiento","Producto","IVU","Total entrada","Valor entrada","Total Salida","Valor Salida","Total Balance","Valor Balance","Proveedor","Fecha"]],p=w.map(a=>{var o,c,r,h;return[a==null?void 0:a.movement_type,a==null?void 0:a.product.code_product,((o=a==null?void 0:a.unit_value)==null?void 0:o.toFixed(2))??"",(a==null?void 0:a.quantity_entry)??"",((c=a==null?void 0:a.total_entry)==null?void 0:c.toFixed(2))??"",(a==null?void 0:a.quantity_exit)??"",((r=a==null?void 0:a.total_exit)==null?void 0:r.toFixed(2))??"",(a==null?void 0:a.quantity_balance)??"",((h=a==null?void 0:a.total_balance)==null?void 0:h.toFixed(2))??"",a==null?void 0:a.supplier.company_name,T(a.createdAt)]});return e.jsx(e.Fragment,{children:x&&e.jsx(H,{tableHead:j,tableBody:p,isOpen:x,title:"Reporte kardex",onClose:u})})},Fe=()=>{const[n,f]=l.useState(""),[w,g]=l.useState(null),[x,m]=l.useState(!1),[u,j]=l.useState(!1),[p,a]=l.useState([]),[o,c]=l.useState(!1),[r,h]=l.useState(null);l.useEffect(()=>{(async()=>{m(!0);try{const d=await _e();a(d),console.log(d)}catch{g("Error al cargar las ventas")}finally{m(!1)}})()},[]);const b=s=>f(s.toLowerCase()),B=l.useMemo(()=>Se(p,n,["id_kardex","description"]),[p,n]),v=s=>{h(s),j(!0)},y=()=>{h(null),j(!1)},N=s=>{h(s),c(!0)},D=()=>{c(!1)},k=[{name:e.jsxs("div",{className:"flex items-center gap-1 text-xs font-medium text-neutral-500 dark:text-neutral-300",children:[e.jsx(fe,{}),e.jsx("span",{children:"Movimiento"})]}),selector:s=>s.createdAt,sortable:!0,minWidth:"10px",cell:s=>e.jsx("div",{className:"flex flex-col gap-y-1 py-2 text-xs text-neutral-500 dark:text-neutral-300",children:e.jsx("span",{className:`rounded-sm px-2 py-0.5 ${s.movement_type==="Entrada"?"bg-green-100 text-green-600 dark:bg-green-800/60 dark:text-green-300":s.movement_type==="Salida"?"bg-red-100 text-red-600 dark:bg-red-800/60 dark:text-red-300":s.movement_type==="Ajuste"?"bg-sky-100 text-sky-600 dark:bg-sky-800/60 dark:text-sky-300":"bg-gray-100 text-gray-600 dark:bg-gray-800/60 dark:text-gray-300"}`,children:s.movement_type})})},{name:e.jsxs("div",{className:"flex items-center gap-1 text-xs font-medium text-neutral-500 dark:text-neutral-300",children:[e.jsx(je,{}),e.jsx("span",{children:"Detalle"})]}),selector:s=>s.detail,sortable:!0,minWidth:"200px",cell:s=>e.jsx("div",{className:"text-xs text-neutral-500 dark:text-neutral-300",children:s.detail})},{name:e.jsxs("div",{className:"flex items-center gap-1 text-xs font-medium text-neutral-500 dark:text-neutral-300",children:[e.jsx(W,{}),e.jsx("span",{children:"Código barras"})]}),selector:s=>s.code_bar,sortable:!0,minWidth:"250px",cell:s=>e.jsx("div",{className:"text-xs text-neutral-500 dark:text-neutral-300",children:s.code_bar?s.code_bar:"No especificado"})},{name:e.jsxs("div",{className:"flex items-center gap-1 text-xs font-medium text-neutral-500 dark:text-neutral-300",children:[e.jsx(ge,{}),e.jsx("span",{children:"Producto"})]}),selector:s=>s.description,sortable:!0,minWidth:"300px",cell:s=>e.jsx("div",{className:"text-xs text-neutral-500 dark:text-neutral-300",children:s.description})},{name:e.jsxs("div",{className:"flex items-center gap-1 text-xs font-medium text-neutral-500 dark:text-neutral-300",children:[e.jsx(be,{}),e.jsx("span",{children:"Total balance"})]}),selector:s=>s.quantity_balance,sortable:!0,minWidth:"0px",cell:s=>e.jsx("div",{className:"text-xs text-neutral-500 dark:text-neutral-300",children:s.quantity_balance})},{name:e.jsxs("div",{className:"flex items-center gap-1 text-xs font-medium text-neutral-500 dark:text-neutral-300",children:[e.jsx(ve,{}),e.jsx("span",{children:"Acciones"})]}),minWidth:"100px",cell:s=>e.jsxs("div",{className:"flex justify-end gap-2 p-2 text-xs text-neutral-500 dark:text-neutral-300",children:[e.jsx("button",{onClick:d=>{d.stopPropagation(),v(s)},className:"flex items-center gap-2 rounded-sm bg-neutral-100 px-2 py-1 font-medium text-neutral-500 transition-colors duration-150 hover:bg-neutral-200 hover:text-neutral-600 focus:outline-none dark:bg-neutral-700 dark:text-neutral-200 dark:hover:bg-neutral-600",children:e.jsx(Ne,{size:14})}),e.jsx("button",{onClick:d=>{d.stopPropagation(),N(s)},className:"flex items-center gap-2 rounded-sm bg-sky-100 px-2 py-1 font-medium text-sky-500 transition-colors duration-150 hover:bg-sky-200 hover:text-sky-600 focus:outline-none dark:bg-sky-700 dark:text-sky-200 dark:hover:bg-sky-600",children:e.jsx(ke,{size:14})})]})}];return e.jsx(e.Fragment,{children:x?e.jsx("div",{className:"flex h-screen items-center justify-center",children:e.jsx(z,{text:"Cargando kardex, espera un momento :)"})}):e.jsx("main",{className:"mx-auto max-w-7xl py-20",children:e.jsxs("div",{className:"flex flex-col gap-4 gap-x-20",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex items-center gap-2 text-lg font-medium",children:e.jsx("span",{children:"Kardex"})}),e.jsx("div",{className:"flex flex-row items-center",children:e.jsx("div",{className:"flex gap-4",children:e.jsx(we,{onSearch:b})})})]}),e.jsx("div",{className:"max-h-full overflow-y-auto rounded-md pt-4",children:e.jsx(ye,{columns:k,data:B,expandableRows:!1})}),u&&e.jsx(Re,{k_product:r,isOpen:u,onClose:y}),o&&e.jsx(Me,{id_product:r==null?void 0:r.product_fk,onClose:D})]})})})};function Ee(){return e.jsx(Fe,{})}export{Ee as default};
