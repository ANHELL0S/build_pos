import{r as s,j as e,A as re,m as A,b as le,c as ne,d as M,e as de,f as ie,g as I,h as oe,B as w,T as ce,J as E,u as xe,S as ue,i as me,k as pe,l as fe,n as he,o as ge,p as U,q as be,s as je,t as ve,v as ke,w as W}from"./index-CwctY5k1.js";import{d as q}from"./date.util-DC23xNcO.js";import{S as ye,T as Ne,R as we}from"./ReportModal-D58ign_A.js";import{g as O,c as Ce}from"./sale.api-BvUheGVx.js";import{C as Se}from"./ChartLine-B2YQ3SDa.js";import{f as Fe}from"./convertFloatToDecimal.util-4Gwe17GD.js";import{E as Te}from"./jspdf.plugin.autotable-CTNFFBrn.js";import{A as De}from"./AnimatedDropdown-BizZW_Ly.js";import"./spinner-CavXBNdq.js";const Le=({sale:r,onClose:d})=>{const[p,n]=s.useState(!1);s.useEffect(()=>(n(!0),document.addEventListener("keydown",u),()=>{document.body.style.overflow="",document.removeEventListener("keydown",u)}),[]);const u=o=>{o.key==="Escape"&&(n(!1),setTimeout(d,300))};if(!r)return null;const f={hidden:{opacity:0,backdropFilter:"blur(0px)"},visible:{opacity:1,backdropFilter:"blur(2px)",transition:{duration:.2}}},c={hidden:{opacity:0,scale:1,x:"100%",transition:{duration:.2,ease:"easeInOut"}},visible:{opacity:1,scale:1,x:"0%",transition:{duration:.2,ease:"circIn"}}};return e.jsx(re,{children:p&&e.jsxs(A.div,{className:"fixed inset-0 z-50 flex items-center justify-end overflow-auto",initial:"hidden",animate:"visible",exit:"hidden",variants:f,onClick:()=>{n(!1),setTimeout(d,300)},children:[e.jsx(A.div,{className:"absolute inset-0 bg-neutral-50/50 dark:bg-neutral-900/50",variants:f}),e.jsxs(A.div,{className:"relative flex h-full max-h-full w-full max-w-lg flex-col gap-y-5 border bg-white p-6 shadow-lg dark:border-neutral-700 dark:bg-neutral-900",variants:c,onClick:o=>o.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex flex-row items-center gap-2 font-medium text-neutral-600 dark:text-neutral-300",children:[e.jsx("div",{className:"rounded-lg border p-2 dark:border-neutral-700",children:e.jsx(le,{})}),e.jsx("span",{children:"Detalles de la venta"})]}),e.jsx("div",{onClick:()=>{n(!1),setTimeout(d,300)},className:"cursor-pointer rounded-md p-1.5 text-lg text-neutral-400 transition-colors duration-150 hover:bg-neutral-100 hover:text-neutral-500 dark:hover:bg-neutral-800 dark:hover:text-neutral-300",children:e.jsx(ne,{})})]}),e.jsxs("div",{className:"flex h-full flex-col gap-8 overflow-auto",children:[e.jsxs("div",{className:"space-y-4 text-sm text-neutral-500 dark:text-neutral-500",children:[e.jsxs("div",{className:"flex justify-between gap-6 text-xs font-medium",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2 rounded-md bg-sky-100 px-3 py-1 text-sky-600 dark:bg-sky-800/30",children:[e.jsx(M,{}),e.jsx("p",{children:r.id_ticket})]}),e.jsxs("div",{className:"flex items-center gap-2 rounded-md bg-green-200 px-2 py-1 text-green-600 dark:bg-green-800/30",children:["$",e.jsx("p",{children:Fe(r.total)})]})]}),e.jsxs("div",{className:"flex items-center gap-2 rounded-md bg-neutral-100 px-3 py-1 dark:bg-neutral-900",children:[e.jsx(de,{className:"text-neutral-500"}),e.jsx("p",{children:q(r.createdAt)})]})]}),e.jsxs("div",{className:"flex items-center rounded-lg bg-neutral-50 p-4 text-neutral-500 dark:bg-neutral-800 dark:text-neutral-300",children:[e.jsx(ie,{size:48,value:r.client.names}),e.jsxs("div",{className:"ml-4 flex-1",children:[e.jsxs("div",{className:"mb-2 flex items-center gap-2",children:[e.jsx(I,{}),e.jsx("p",{children:r.client.names})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("p",{children:["Despachado por: ",r.employee.username]})})]})]})]}),e.jsx("div",{className:"flex-grow border-gray-200",children:e.jsx("div",{className:"relative flex h-full w-full justify-center",children:e.jsx("iframe",{src:`data:application/pdf;base64,${r.bill_pdf}`,type:"application/pdf",className:"h-full w-full rounded-lg border-none",title:"Vista Previa del PDF",loading:"lazy"})})})]})]})]})})},Pe=({isOpen:r,onClose:d})=>{const[p,n]=s.useState(""),[u,f]=s.useState(""),[c,o]=s.useState(!1),[j,C]=s.useState(!1),[h,v]=s.useState(null),k=async()=>{o(!0);try{const l=await O();if(!l.length){E.warning("No hay ventas para generar el PDF"),o(!1);return}const m=new Te;l.forEach((a,g)=>{const{bill_pdf:b,id_ticket:T}=a;if(b){const y=`data:image/png;base64,${b}`;g>0&&m.addPage(),m.text(`Venta ${T}`,10,10),m.addImage(y,"PNG",10,20,180,160)}});const S=m.output("blob"),F=URL.createObjectURL(S);v(F),C(!0),E.success("PDF generado exitosamente")}catch(l){console.error(l),E.error("Error al generar el PDF")}finally{o(!1)}};return r?e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",children:[e.jsxs("div",{className:"relative w-full max-w-lg rounded-lg bg-white p-6 shadow-lg",children:[e.jsxs("div",{className:"mb-4 flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Enviar a contador"}),e.jsx("button",{onClick:d,children:e.jsx(oe,{size:24})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Correo electrÃ³nico"}),e.jsx("input",{type:"email",className:"focus:ring-primary focus:border-primary mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:outline-none sm:text-sm",value:p,onChange:l=>n(l.target.value),placeholder:"ejemplo@correo.com"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Mensaje"}),e.jsx("textarea",{className:"focus:ring-primary focus:border-primary mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:outline-none sm:text-sm",value:u,onChange:l=>f(l.target.value),placeholder:"Escribe un mensaje",rows:"4"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx(w,{onClick:k,loading:c,disabled:c,children:c?"Generando PDF...":"Generar PDF"}),j&&h&&e.jsx("a",{href:h,download:"reporte_ventas.pdf",className:"flex items-center gap-2 rounded-sm bg-blue-500 px-3 py-1 text-white transition hover:bg-blue-600",children:"Descargar PDF"})]})]})]}),e.jsx(ce,{})]}):null},Ae=()=>{const{userRole:r}=xe(),[d,p]=s.useState([]),[n,u]=s.useState(""),[f,c]=s.useState(null),[o,j]=s.useState(!1),[C,h]=s.useState(!1),[v,k]=s.useState(null),[l,m]=s.useState(!1),[S,F]=s.useState(!1),[a,g]=s.useState({dateFrom:"",dateTo:"",clientType:"all",status:"all"});s.useEffect(()=>{b()},[]);const b=async()=>{j(!0);try{const t=await O();p(t)}catch{c("Error al cargar las ventas")}finally{j(!1)}},T=t=>u(t.toLowerCase()),y=t=>{g({...a,[t.target.name]:t.target.value})},R=t=>{g({...a,[t.target.name]:t.target.value})},X=s.useMemo(()=>d.filter(t=>{var N,z,V,G;const i=t.id_ticket.toLowerCase().includes(n)||((N=t.client)==null?void 0:N.names)&&t.client.names.toLowerCase().includes(n)||((z=t.employee)==null?void 0:z.username)&&t.employee.username.toLowerCase().includes(n),D=(a.dateFrom?new Date(t.createdAt)>=new Date(a.dateFrom):!0)&&(a.dateTo?new Date(t.createdAt)<=new Date(a.dateTo):!0),L=a.clientType==="all"||a.clientType==="consumidorFinal"&&((V=t.client)==null?void 0:V.names)==="Consumidor Final"||a.clientType==="conDatos"&&((G=t.client)==null?void 0:G.names)!=="Consumidor Final",P=a.status==="invoiced"?t.active===!0:a.status==="pendient"?t.active===!1:!0,x=a.active===!0&&t.active===!0||a.active===!1&&t.active===!1||a.active===void 0;return i&&D&&L&&P&&x}),[d,n,a]),J=t=>{k(t),h(!0)},K=()=>{k(null),h(!1)},[H,_]=s.useState(!1),Q=async t=>{try{_(!0);const i=await Ce(t.id_bill_sale);W({type:"success",message:i.message}),await b()}catch(i){W({type:"error",message:i.message})}finally{_(!1)}},Y=[{name:e.jsxs("div",{className:"flex items-center gap-1 text-xs font-medium text-neutral-500 dark:text-neutral-300",children:[e.jsx(he,{size:15}),e.jsx("span",{children:"Facturado"})]}),selector:t=>t.active,sortable:!0,minWidth:"100px",cell:t=>e.jsx("div",{className:`inline-flex items-center gap-1 rounded-sm px-2 py-0.5 text-xs font-medium ${t.active?"bg-green-100 text-green-600 dark:bg-green-800/60 dark:text-green-300":"bg-red-100 text-red-600 dark:bg-red-800/60 dark:text-red-300"}`,children:t.active?"Facturada":"Pendiente"})},{name:e.jsxs("div",{className:"flex items-center gap-1 text-xs font-medium text-neutral-500 dark:text-neutral-300",children:[e.jsx(M,{}),e.jsx("span",{children:"Ticket"})]}),selector:t=>t.id_ticket,sortable:!0,minWidth:"105px",cell:t=>e.jsx("div",{className:"text-xs text-neutral-500 dark:text-neutral-300",children:t.id_ticket})},{name:e.jsxs("div",{className:"flex items-center gap-1 text-xs font-medium text-neutral-500 dark:text-neutral-300",children:[e.jsx(M,{}),e.jsx("span",{children:"Total"})]}),selector:t=>t.total,sortable:!0,minWidth:"105px",cell:t=>e.jsxs("div",{className:"rounded-sm bg-neutral-200 px-2 py-0.5 text-xs text-neutral-500 dark:bg-neutral-700 dark:text-neutral-300",children:["$ ",t.total.toFixed(2)]})},{name:e.jsxs("div",{className:"flex items-center gap-1 text-xs font-medium text-neutral-500 dark:text-neutral-300",children:[e.jsx(I,{}),e.jsx("span",{children:"Cliente"})]}),selector:t=>{var i;return(i=t.client)==null?void 0:i.names},sortable:!0,minWidth:"180px",cell:t=>e.jsx("div",{className:"text-xs text-neutral-500 dark:text-neutral-300",children:t.client.names})},{name:e.jsxs("div",{className:"flex items-center gap-1 text-xs font-medium text-neutral-500 dark:text-neutral-300",children:[e.jsx(ge,{}),e.jsx("span",{children:"Fecha"})]}),selector:t=>U(t.createdAt),sortable:!0,minWidth:"200px",cell:t=>e.jsx("div",{className:"text-xs text-neutral-500 dark:text-neutral-300",children:U(t.createdAt)})},{name:e.jsxs("div",{className:"flex items-center gap-1 text-xs font-medium text-neutral-500 dark:text-neutral-300",children:[e.jsx(be,{}),e.jsx("span",{children:"Acciones"})]}),sortable:!1,minWidth:"0px",cell:t=>e.jsxs("div",{className:"flex gap-2 p-2 text-xs",children:[e.jsx("button",{onClick:()=>J(t),className:"flex items-center gap-2 rounded-sm bg-neutral-100 px-2 py-1 font-medium text-neutral-500 transition-colors duration-150 hover:bg-neutral-200 hover:text-neutral-600 focus:outline-none dark:bg-neutral-700 dark:text-neutral-200 dark:hover:bg-neutral-600",children:e.jsx(je,{size:14})}),r==="counter"&&e.jsx("button",{onClick:()=>Q(t),disabled:H,className:"flex items-center gap-2 rounded-sm bg-teal-100 px-2 py-1 font-medium text-teal-500 transition-colors duration-150 hover:bg-teal-200 hover:text-teal-600 focus:outline-none dark:bg-teal-700 dark:text-teal-200 dark:hover:bg-teal-600",children:e.jsx(ve,{size:14})}),e.jsx("a",{href:`data:application/pdf;base64,${t.bill_pdf}`,download:`${t.id_ticket}.pdf`,className:"flex items-center gap-2 rounded-sm bg-sky-100 px-2 py-1 font-medium text-sky-500 transition-colors duration-150 hover:bg-sky-200 hover:text-sky-600 focus:outline-none dark:bg-sky-800 dark:text-sky-200 dark:hover:bg-sky-700",children:e.jsx(ke,{size:14})})]})}],Z=()=>$(!0),[B,$]=s.useState(!1),ee=()=>$(!1),te=[["Ticket","Cliente","Vendedor","Total","Fecha"]],ae=d.map(t=>[t.id_ticket,t.client.names,t.employee.username,`$${t.total.toFixed(2)}`,q(t.createdAt)]),se=({sales:t})=>{const i=t.length,D=t.reduce((x,N)=>x+(parseFloat(N.total)||0),0).toFixed(2),L=t.filter(x=>x.active).length,P=t.filter(x=>!x.active).length;return e.jsx("div",{children:e.jsxs("div",{className:"grid grid-cols-1 gap-6 text-neutral-500 sm:grid-cols-2 md:grid-cols-2 lg:grid-cols-2",children:[e.jsxs("div",{className:"flex transform items-center gap-4 rounded-lg border-l-4 border-teal-400 bg-neutral-50 p-4 text-start dark:border-teal-200 dark:bg-neutral-800 dark:text-teal-200",children:[e.jsx("div",{className:"rounded-full bg-teal-300/50 px-4 py-2 text-xl font-semibold dark:bg-teal-300/50",children:i}),e.jsx("div",{children:e.jsx("p",{className:"text-sm font-medium dark:text-teal-200/80",children:"Ventas"})})]}),e.jsx("div",{className:"flex transform items-center gap-4 rounded-lg border-l-4 border-green-400 bg-neutral-50 p-4 text-start dark:border-green-200 dark:bg-neutral-800 dark:text-green-200",children:e.jsxs("div",{className:"rounded-full bg-green-300/50 px-4 py-2 text-xl font-semibold dark:bg-green-300/50",children:["$ ",D]})}),e.jsxs("div",{className:"flex transform items-center gap-4 rounded-lg border-l-4 border-sky-400 bg-neutral-50 p-4 text-start dark:border-sky-200 dark:bg-neutral-800 dark:text-sky-200",children:[e.jsx("div",{className:"rounded-full bg-sky-300/50 px-4 py-2 text-xl font-semibold dark:bg-sky-300/50",children:L}),e.jsx("div",{children:e.jsx("p",{className:"text-sm font-medium dark:text-sky-200/80",children:"Facturadas"})})]}),e.jsxs("div",{className:"flex transform items-center gap-4 rounded-lg border-l-4 border-red-400 bg-neutral-50 p-4 text-start dark:border-red-200 dark:bg-neutral-800 dark:text-red-200",children:[e.jsx("div",{className:"rounded-full bg-red-300/50 px-4 py-2 text-xl font-semibold dark:bg-red-300/50",children:P}),e.jsx("div",{children:e.jsx("p",{className:"text-sm font-medium dark:text-red-200/80",children:"Pendientes"})})]})]})})};return e.jsx(e.Fragment,{children:o?e.jsx("div",{className:"flex h-screen items-center justify-center",children:e.jsx(ue,{text:"Cargando ventas, espera un momento :)"})}):e.jsx("main",{className:"mx-auto max-w-7xl py-20",children:e.jsxs("div",{className:"flex flex-col gap-2 gap-x-20",children:[e.jsxs("div",{className:"grid gap-10 pt-3 sm:grid-cols-1 md:grid-cols-3",children:[e.jsxs("div",{className:"col-span-1 flex flex-col gap-y-6 md:col-span-1",children:[e.jsx(se,{sales:d}),e.jsx(Se,{fetchData:O,dataKey:"createdAt",label:"Ventas",filters:["Mensual","Anual","Semanal"],initialFilter:"Mensual"})]}),e.jsxs("div",{className:"col-span-1 max-h-full overflow-y-auto rounded-md md:col-span-2",children:[e.jsxs("div",{className:"flex items-center justify-between pb-6",children:[e.jsx("div",{className:"flex items-center text-lg font-medium",children:e.jsx("span",{children:"Ventas"})}),e.jsx("div",{className:"flex flex-row items-center",children:e.jsxs("div",{className:"flex gap-4",children:[e.jsx(ye,{onSearch:T}),e.jsx(w,{onClick:Z,variant:"outline",icon:me,children:"Reporte"}),e.jsx(w,{onClick:()=>m(!l),variant:"outline",children:l?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(pe,{}),e.jsx("span",{children:"Filtros"})]}):e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(fe,{}),e.jsx("span",{children:"Filtros"})]})}),e.jsx(De,{isOpen:l,className:"right-7 top-32",children:e.jsxs("div",{className:"flex flex-col gap-6 p-4 text-xs font-medium",children:[e.jsxs("div",{className:"flex justify-between gap-4",children:[e.jsxs("div",{className:"flex w-full flex-col",children:[e.jsx("label",{className:"flex items-center",children:"Fecha inicio"}),e.jsx("input",{type:"date",name:"dateFrom",value:a.dateFrom,onChange:R,className:"mt-2 rounded-md border border-neutral-100 bg-neutral-50 p-2 focus:border-neutral-500 focus:ring-neutral-500 dark:border-neutral-700 dark:bg-neutral-800"})]}),e.jsxs("div",{className:"flex w-full flex-col",children:[e.jsx("label",{className:"flex items-center",children:"Fecha fin"}),e.jsx("input",{type:"date",name:"dateTo",value:a.dateTo,onChange:R,className:"mt-2 rounded-md border border-neutral-100 bg-neutral-50 p-2 focus:border-neutral-500 focus:ring-neutral-500 dark:border-neutral-700 dark:bg-neutral-800"})]})]}),e.jsxs("div",{className:"flex w-full flex-col",children:[e.jsx("label",{className:"flex items-center",children:"Tipo de cliente"}),e.jsxs("select",{name:"clientType",value:a.clientType,onChange:y,className:"mt-2 rounded-md border border-neutral-100 bg-neutral-50 p-2 focus:border-neutral-500 focus:ring-neutral-500 dark:border-neutral-700 dark:bg-neutral-800",children:[e.jsx("option",{value:"all",children:"Todos"}),e.jsx("option",{value:"consumidorFinal",children:"Solo consumidores finales"}),e.jsx("option",{value:"conDatos",children:"Solo clintes"})]})]}),e.jsxs("div",{className:"flex w-full flex-col",children:[e.jsx("label",{className:"flex items-center",children:"Estado"}),e.jsxs("select",{name:"status",value:a.status,onChange:y,className:"mt-2 rounded-md border border-neutral-100 bg-neutral-50 p-2 focus:border-neutral-500 focus:ring-neutral-500 dark:border-neutral-700 dark:bg-neutral-800",children:[e.jsx("option",{value:"all",children:"Todos"}),e.jsx("option",{value:"invoiced",children:"Facturadas"}),e.jsx("option",{value:"pendient",children:"Pendientes"})]})]}),e.jsx(w,{variant:"primary",onClick:()=>g({...a,dateFrom:"",dateTo:"",clientType:"all",status:"all"}),children:"Restablecer Filtros"})]})})]})})]}),e.jsx(Ne,{columns:Y,data:X})]})]}),C&&v&&e.jsx(Le,{sale:v,onClose:K}),B&&e.jsx(we,{tableHead:te,tableBody:ae,isOpen:B,title:"Reporte ventas",onClose:ee}),S&&e.jsx(Pe,{onClose:()=>F(!1)})]})})})};function Ge(){return e.jsx(Ae,{})}export{Ge as default};
